<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font: 10px sans-serif;
}

svg {
  padding: 10px 0 0 10px;
}

.arc {
  stroke: #fff;
}

</style>
<body>
    <p>Top Employers</p>
</body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script>
    var radius = 44,
        padding = 10;
    var color = d3.scale.ordinal().range(["#98abc5","#8a89a6"]);
    var arc = d3.svg.arc().outerRadius(radius).innerRadius(radius-30);
    var pie = d3.layout.pie().sort(null).value(function(d) {return d.Employer});

    var topEmployersObjList = [];

    d3.csv("dataset.csv", function(error,data){
        if (error) throw error;
        
        //tableObj[objKey]: Employer, value: Occurrences, plans: list of {tableObj[objKey]: Plan, value: Occurences}
        var tableObj = {};
        //Object containing the top tableObj's
        var topEmployersObj = {};
        var firstObj = "firstObj";
        var secondObj = "secondObj";
        var thirdObj = "thirdObj";
        var fourthObj = "fourthObj";
        var fifthObj = "fifthObj";
        
        data.forEach(function(d){
            if (tableObj[d.Employer] == null){
                tableObj[d.Employer] = {};
                tableObj[d.Employer].name = d.Employer;
                tableObj[d.Employer].value = 1;
                tableObj[d.Employer][d.Plan] = 1;
            } else {
                tableObj[d.Employer].value++;
                if (tableObj[d.Employer][d.Plan] == null){
                    tableObj[d.Employer][d.Plan] = 1;
                } else {
                    tableObj[d.Employer][d.Plan]++;
                }
            }
        });
        
        function copyEmployerToObj (objResult, objToCopy){
            objResult.name = objToCopy.name;
            objResult.value = objToCopy.value;
            for(var property in objToCopy){
                if (objToCopy.hasOwnProperty(property)){
                    objResult[property] = objToCopy[property];
                }
            }
            return objResult;
        } 
        for(var objKey in tableObj){
            if (topEmployersObj[firstObj] == null || 
                tableObj[objKey].value > topEmployersObj[firstObj].value){
                topEmployersObj[firstObj] = {};
                copyEmployerToObj(topEmployersObj[firstObj], tableObj[objKey]);
            } else if (topEmployersObj[secondObj] == null || 
                tableObj[objKey].value > topEmployersObj[secondObj].value){
                topEmployersObj[secondObj] = {};
                copyEmployerToObj(topEmployersObj[secondObj], tableObj[objKey]);
            } else if (topEmployersObj[thirdObj] == null || 
                tableObj[objKey].value > topEmployersObj[thirdObj].value){
                topEmployersObj[thirdObj] = {};
                copyEmployerToObj(topEmployersObj[thirdObj], tableObj[objKey]);
            } else if (topEmployersObj[fourthObj] == null || 
                tableObj[objKey].value > topEmployersObj[fourthObj].value){
                topEmployersObj[fourthObj] = {};
                copyEmployerToObj(topEmployersObj[fourthObj], tableObj[objKey]);
            } else if (topEmployersObj[fifthObj] == null || 
                tableObj[objKey].value > topEmployersObj[fifthObj].value){
                topEmployersObj[fifthObj] = {};
                copyEmployerToObj(topEmployersObj[fifthObj], tableObj[objKey]);
            }
        }
        
        for(var key in topEmployersObj){
            var val = topEmployersObj[key].value;
            var name = topEmployersObj[key].name;
            var stringToLog = "Name: "+name+" Value: "+val+" Plans: {"; 
            for(var plan in topEmployersObj[key]){
                if (plan != "value" && plan != "name"){
                    stringToLog += "(" + "Plan: "+plan+" Vaule: "+topEmployersObj[key][plan] + "), ";
                }
            }
            stringToLog += "}";
            console.log(stringToLog);
            topEmployersObjList.push(topEmployersObj[key]);
            document.write("<p><h2>"+name+"</h2>" + "<h4>Hired: " + val + "</h4></p>");
        }
        console.log(topEmployersObj);        
    });
</script>
    